<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    <title>Calendar View - Shift Pay Calculator</title>
    
    <!-- Mobile optimizations -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <meta name="format-detection" content="telephone=no">

    <!-- PWA Manifest -->
    <link rel="manifest" href="../manifest.json" />
    
    <!-- Styles -->
    <link rel="stylesheet" href="../assets/css/main.css" />
    <link rel="stylesheet" href="../assets/css/calendar.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üóìÔ∏è</text></svg>"
    />
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar Navigation -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <h2>üè≠ ShiftPay</h2>
          <p>Calendar View</p>
        </div>
        <ul class="nav-menu">
          <li class="nav-item" onclick="navigateToMainApp('dashboard')">
            <span class="nav-icon">üìä</span>
            Dashboard
          </li>
          <li class="nav-item" onclick="navigateToMainApp('calculator')">
            <span class="nav-icon">üí∞</span>
            Calculator
          </li>
          <li class="nav-item" onclick="navigateToMainApp('weekly')">
            <span class="nav-icon">üìÖ</span>
            Weekly Report
          </li>
          <li class="nav-item active">
            <span class="nav-icon">üóìÔ∏è</span>
            Calendar View
          </li>
          <!-- Monthly Analysis link removed -->
          <li class="nav-item" onclick="navigateToMainApp('shifts')">
            <span class="nav-icon">‚è∞</span>
            Shift Schedule
          </li>
          <li class="nav-item" onclick="navigateToMainApp('settings')">
            <span class="nav-icon">‚öôÔ∏è</span>
            Settings
          </li>
        </ul>
      </nav>

      <!-- Main Content (·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·ÄÄ code ·Ä°·ÄÄ·ÄØ·Äî·Ä∫ ·Ä°·Äõ·ÄÑ·Ä∫·Ä°·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äï·Ä≤) -->
      <main class="main-content">
        <div class="page-header">
          <div>
            <h1>Calendar View</h1>
            <p>Track your shifts and earnings by date</p>
          </div>
          <div class="calendar-controls">
            <button class="month-nav-btn" onclick="previousMonth()">
              <span>‚Üê</span>
            </button>
            <h2 id="currentMonthYear">November 2024</h2>
            <button class="month-nav-btn" onclick="nextMonth()">
              <span>‚Üí</span>
            </button>
          </div>
        </div>

        <!-- Calendar Container -->
        <div class="calendar-wrapper">
          <div class="calendar-container">
            <div class="calendar-header">
              <div class="day-header">Sun</div>
              <div class="day-header">Mon</div>
              <div class="day-header">Tue</div>
              <div class="day-header">Wed</div>
              <div class="day-header">Thu</div>
              <div class="day-header">Fri</div>
              <div class="day-header">Sat</div>
            </div>
            <div id="calendarGrid" class="calendar-grid">
              <!-- Calendar days will be generated here -->
            </div>
          </div>

          <!-- Monthly Summary -->
          <div class="monthly-summary">
            <h3>üìä Monthly Summary</h3>
            <div class="summary-content">
              <div class="summary-item salary-period">
                <span class="summary-label">Salary Period:</span>
                <div class="salary-period-inputs">
                  <input type="date" id="salaryStartDate" class="date-input" />
                  <span class="date-separator">to</span>
                  <input type="date" id="salaryEndDate" class="date-input" />
                </div>
              </div>
              <div class="summary-item">
                <span class="summary-label">Total Days Worked:</span>
                <span class="summary-value" id="totalDaysWorked">0</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Day Shifts:</span>
                <span class="summary-value" id="dayShifts">0</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Night Shifts:</span>
                <span class="summary-value" id="nightShifts">0</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Total Hours:</span>
                <span class="summary-value" id="totalHours">0h</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Total Earnings:</span>
                <span class="summary-value" id="totalEarnings">¬•0</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Take-home (77.7%):</span>
                <span class="summary-value" id="takeHome">¬•0</span>
              </div>
            </div>

            <!-- Legend -->
            <div class="calendar-legend">
              <h4>Legend</h4>
              <div class="legend-item">
                <span class="legend-dot day-shift"></span>
                <span>Day Shift (C341)</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot night-shift"></span>
                <span>Night Shift (C342)</span>
              </div>
              <div class="legend-item">
                <span class="legend-icon">üí∞</span>
                <span>Pay Day (25th)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
          <div class="stat-card">
            <div class="stat-icon">üìà</div>
            <div class="stat-content">
              <h3 id="avgDailyEarnings">¬•0</h3>
              <p>Avg Daily Earnings</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">‚è±Ô∏è</div>
            <div class="stat-content">
              <h3 id="avgDailyHours">0h</h3>
              <p>Avg Daily Hours</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-content">
              <h3 id="monthlyProgress">0%</h3>
              <p>Monthly Goal</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üí™</div>
            <div class="stat-content">
              <h3 id="streakDays">0</h3>
              <p>Work Streak</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Day Details Modal -->
    <div id="dayModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalDate">Date</h3>
          <button class="modal-close" onclick="closeDayModal()">√ó</button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Day details will be populated here -->
        </div>
        
        <!-- Add/Edit Shift Form -->
        <div class="shift-form" id="shiftForm" style="display: none;">
          <div class="form-group">
            <label for="modalShiftType" class="required">Shift Type:</label>
            <select id="modalShiftType" class="form-input" required>
              <option value="">Select Shift Type</option>
              <option value="C341">C341 - Day Shift (06:30„Äú17:30)</option>
              <option value="C342">C342 - Night Shift (16:45„Äú01:25)</option>
            </select>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="modalStartTime" class="required">Start Time:</label>
              <input type="time" id="modalStartTime" class="form-input" required />
            </div>
            <div class="form-group">
              <label for="modalEndTime" class="required">End Time:</label>
              <input type="time" id="modalEndTime" class="form-input" required />
            </div>
          </div>

          <!-- Break Schedule Display -->
          <div id="modalShiftInfo" class="shift-info" style="display: none">
            <div class="break-schedule-header">
              <h4>üìã Break Schedule</h4>
              <button type="button" class="break-toggle-btn" onclick="toggleBreakDetails()" id="breakToggleBtn">
                <span class="toggle-icon">üëÅÔ∏è</span>
                <span class="toggle-text">Show Details</span>
              </button>
            </div>
            <div id="modalBreakList" class="break-list collapsible-content" style="display: none">
              <!-- Break details will be populated here -->
            </div>
            <div id="breakSummaryOnly" class="break-summary-compact">
              <!-- Compact summary will be shown when details are hidden -->
            </div>
          </div>
          
          <!-- Pay Preview -->
          <div class="pay-preview" id="payPreview">
            <h4>üí∞ Pay Breakdown</h4>
            <div class="preview-item">
              <span>Total Hours:</span>
              <span id="previewTotalHours">0h</span>
            </div>
            <div class="preview-item">
              <span>Break Time:</span>
              <span id="previewBreak">0h</span>
            </div>
            <div class="preview-item">
              <span>Net Working:</span>
              <span id="previewNetHours">0h</span>
            </div>
            <div class="preview-separator"></div>
            <div class="preview-item">
              <span>Regular Pay:</span>
              <span id="previewRegularPay">¬•0</span>
            </div>
            <div class="preview-item" id="previewOvertimeRow" style="display: none">
              <span>Overtime Pay:</span>
              <span id="previewOvertimePay">¬•0</span>
            </div>
            <div class="preview-item" id="previewNightRow" style="display: none">
              <span>Night Premium:</span>
              <span id="previewNightPay">¬•0</span>
            </div>
            <div class="preview-separator"></div>
            <div class="preview-item total">
              <span>Total Pay:</span>
              <span id="previewTotalPay">¬•0</span>
            </div>
            <div class="preview-item">
              <span>Take-home (77.7%):</span>
              <span id="previewTakeHome">¬•0</span>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button class="btn-delete" onclick="deleteShift()" id="deleteBtn">Delete Shift</button>
          <button class="btn-edit" onclick="editShift()" id="editBtn">Edit Shift</button>
          <button class="btn-add" onclick="showAddShiftForm()" id="addBtn">Add Shift</button>
          <button class="btn-cancel" onclick="cancelShiftForm()" id="cancelBtn" style="display: none;">Cancel</button>
          <button class="btn-save" onclick="saveShift()" id="saveBtn" style="display: none;">Save</button>
        </div>
      </div>
    </div>

    <!-- Mobile menu toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
    <div class="mobile-overlay" onclick="closeMobileMenu()"></div>

    <!-- Scripts -->
    <script src="../assets/js/modules/break_schedule.js"></script>
    <script src="../assets/js/modules/calendar.js"></script>

    <script>
      // Mobile menu functions
      function toggleMobileMenu() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".mobile-overlay");
        const toggle = document.querySelector(".mobile-menu-toggle");

        sidebar.classList.toggle("mobile-open");
        overlay.classList.toggle("active");
        toggle.innerHTML = sidebar.classList.contains("mobile-open")
          ? "‚úï"
          : "‚ò∞";
      }

      function closeMobileMenu() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".mobile-overlay");
        const toggle = document.querySelector(".mobile-menu-toggle");

        sidebar.classList.remove("mobile-open");
        overlay.classList.remove("active");
        toggle.innerHTML = "‚ò∞";
      }
    </script>
    
    <!-- Service Worker Registration -->
    <script>
      // Register service worker for PWA functionality
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('../sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
    </script>
  </body>
</html>
