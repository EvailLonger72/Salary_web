<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Period Date Range Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 5px 0; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        input, button { margin: 5px; padding: 8px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üóìÔ∏è Salary Period Date Range Test</h1>
    
    <div class="test-section">
        <h3>Issue Description:</h3>
        <p class="info">You added shifts on 5 days (including the 26th), but only 4 days are showing in the salary period summary. The 26th day is not being included.</p>
    </div>
    
    <div class="test-section">
        <h3>Test Salary Period Range:</h3>
        <label>Start Date (26th): </label>
        <input type="date" id="testStartDate" value="2024-11-26">
        
        <label>End Date (25th): </label>
        <input type="date" id="testEndDate" value="2024-12-25">
        
        <button onclick="testDateRange()">üß™ Test Date Range</button>
        <button onclick="testSampleData()">üìä Test with Sample Data</button>
    </div>
    
    <div class="test-section">
        <h3>Sample Shift Data (for testing):</h3>
        <div id="sampleData"></div>
        <button onclick="generateSampleData()">Generate Sample Shifts</button>
    </div>
    
    <div class="test-section">
        <h3>Test Results:</h3>
        <div id="testResults" class="log"></div>
    </div>
    
    <script>
        // Copy the createLocalDate function from calendar.js
        function createLocalDate(dateStr) {
            return new Date(dateStr + "T00:00:00");
        }
        
        // Sample shift data for testing
        let sampleShifts = [];
        
        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = 'result ' + type;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function generateSampleData() {
            // Generate 5 sample shifts including the 26th
            sampleShifts = [
                { workDate: '2024-11-26', shiftType: 'C341', totalPay: 15000 },
                { workDate: '2024-11-27', shiftType: 'C342', totalPay: 16000 },
                { workDate: '2024-12-01', shiftType: 'C341', totalPay: 15000 },
                { workDate: '2024-12-15', shiftType: 'C341', totalPay: 15000 },
                { workDate: '2024-12-25', shiftType: 'C342', totalPay: 16000 }
            ];
            
            const sampleDiv = document.getElementById('sampleData');
            sampleDiv.innerHTML = '<h4>Generated 5 Sample Shifts:</h4>';
            sampleShifts.forEach((shift, index) => {
                sampleDiv.innerHTML += `<div>${index + 1}. ${shift.workDate} - ${shift.shiftType} - ¬•${shift.totalPay}</div>`;
            });
            
            log('‚úÖ Generated 5 sample shifts including 26th', 'success');
        }
        
        function testDateRange() {
            const startDateStr = document.getElementById('testStartDate').value;
            const endDateStr = document.getElementById('testEndDate').value;
            
            if (!startDateStr || !endDateStr) {
                log('‚ùå Please select both start and end dates', 'error');
                return;
            }
            
            log(`üîç Testing date range: ${startDateStr} to ${endDateStr}`, 'info');
            
            // Test the current logic
            const startDate = createLocalDate(startDateStr);
            const endDate = createLocalDate(endDateStr);
            
            log(`üìÖ Start Date Object: ${startDate.toISOString()}`, 'info');
            log(`üìÖ End Date Object: ${endDate.toISOString()}`, 'info');
            
            // Test if range is inclusive
            const testDates = [
                '2024-11-25', // Should be excluded
                '2024-11-26', // Should be included (start date)
                '2024-11-27', // Should be included
                '2024-12-24', // Should be included  
                '2024-12-25', // Should be included (end date)
                '2024-12-26'  // Should be excluded
            ];
            
            log('üß™ Testing date inclusion:', 'info');
            testDates.forEach(dateStr => {
                const testDate = createLocalDate(dateStr);
                const isIncluded = testDate >= startDate && testDate <= endDate;
                const status = isIncluded ? '‚úÖ INCLUDED' : '‚ùå EXCLUDED';
                const expectedStatus = (dateStr >= startDateStr && dateStr <= endDateStr) ? 'should be included' : 'should be excluded';
                log(`${dateStr}: ${status} (${expectedStatus})`, isIncluded === (dateStr >= startDateStr && dateStr <= endDateStr) ? 'success' : 'error');
            });
        }
        
        function testSampleData() {
            if (sampleShifts.length === 0) {
                generateSampleData();
            }
            
            const startDateStr = document.getElementById('testStartDate').value;
            const endDateStr = document.getElementById('testEndDate').value;
            
            if (!startDateStr || !endDateStr) {
                log('‚ùå Please select both start and end dates', 'error');
                return;
            }
            
            log('üîÑ Testing with sample shift data...', 'info');
            
            // Use the same logic as the calendar module
            const startDate = createLocalDate(startDateStr);
            const endDate = createLocalDate(endDateStr);
            
            const filteredData = sampleShifts.filter((entry) => {
                const entryDate = createLocalDate(entry.workDate);
                return entryDate >= startDate && entryDate <= endDate;
            });
            
            log(`üìä Total shifts in sample data: ${sampleShifts.length}`, 'info');
            log(`üìä Shifts in date range (${startDateStr} to ${endDateStr}): ${filteredData.length}`, filteredData.length === 5 ? 'success' : 'error');
            
            log('üìã Filtered shifts:', 'info');
            filteredData.forEach((shift, index) => {
                log(`${index + 1}. ${shift.workDate} - ${shift.shiftType}`, 'success');
            });
            
            if (filteredData.length !== 5) {
                log('‚ùå ISSUE CONFIRMED: Not all 5 shifts are included in the range!', 'error');
                
                // Check which shifts are missing
                sampleShifts.forEach(shift => {
                    const found = filteredData.find(f => f.workDate === shift.workDate);
                    if (!found) {
                        log(`‚ùå Missing shift: ${shift.workDate}`, 'error');
                        
                        // Debug the specific date
                        const entryDate = createLocalDate(shift.workDate);
                        log(`üîç Debug ${shift.workDate}: entryDate=${entryDate.toISOString()}, startDate=${startDate.toISOString()}, endDate=${endDate.toISOString()}`, 'info');
                        log(`üîç entryDate >= startDate: ${entryDate >= startDate}`, 'info');
                        log(`üîç entryDate <= endDate: ${entryDate <= endDate}`, 'info');
                    }
                });
            } else {
                log('‚úÖ SUCCESS: All 5 shifts are correctly included!', 'success');
            }
        }
        
        // Auto-generate sample data on load
        window.addEventListener('load', function() {
            generateSampleData();
            log('üöÄ Salary period test tool loaded. Click buttons to run tests.', 'info');
        });
    </script>
</body>
</html>