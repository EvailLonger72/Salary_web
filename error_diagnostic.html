<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Diagnostic Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .error { color: red; font-weight: bold; }
        .success { color: green; }
        .info { color: blue; }
        button { margin: 5px; padding: 8px 12px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç Navigation Error Diagnostic</h1>
    
    <div class="section">
        <h3>Step 1: Check File Access</h3>
        <button onclick="checkFiles()">Check All Files</button>
        <div id="fileCheck" class="log"></div>
    </div>
    
    <div class="section">
        <h3>Step 2: Test Navigation Links</h3>
        <button onclick="testCalendarNav()">Test: Main ‚Üí Calendar</button>
        <button onclick="testTaxCalcNav()">Test: Main ‚Üí Tax Calc</button>
        <button onclick="testReturnNav()">Test: Calendar ‚Üí Main</button>
        <div id="navTest" class="log"></div>
    </div>
    
    <div class="section">
        <h3>Step 3: Test Cross-Page Navigation</h3>
        <button onclick="testCrossPageFlow()">Test Full Navigation Flow</button>
        <div id="crossPageTest" class="log"></div>
    </div>
    
    <div class="section">
        <h3>Step 4: Check Console Errors</h3>
        <button onclick="checkConsoleErrors()">Capture Console Errors</button>
        <div id="consoleErrors" class="log"></div>
    </div>
    
    <script>
        let originalConsoleError = console.error;
        let capturedErrors = [];
        
        // Capture console errors
        console.error = function(...args) {
            capturedErrors.push(args.join(' '));
            originalConsoleError.apply(console, args);
        };
        
        function log(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.innerHTML = `<span class="${type}">${new Date().toLocaleTimeString()}: ${message}</span>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        async function checkFiles() {
            const container = document.getElementById('fileCheck');
            container.innerHTML = '';
            
            const files = [
                'index.html',
                'pages/calendar.html', 
                'pages/tax-calculator.html',
                'assets/js/core/main.js',
                'assets/js/modules/calendar.js'
            ];
            
            for (let file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        log('fileCheck', `‚úÖ ${file} - accessible`, 'success');
                    } else {
                        log('fileCheck', `‚ùå ${file} - HTTP ${response.status}`, 'error');
                    }
                } catch (error) {
                    log('fileCheck', `‚ùå ${file} - ${error.message}`, 'error');
                }
            }
        }
        
        function testCalendarNav() {
            const container = document.getElementById('navTest');
            log('navTest', 'Testing navigation to calendar...', 'info');
            
            try {
                // Simulate the onclick from index.html
                const testUrl = 'pages/calendar.html';
                
                // Test if URL is valid
                const url = new URL(testUrl, window.location.href);
                log('navTest', `‚úÖ Calendar URL is valid: ${url.href}`, 'success');
                
                // Test navigation (in new tab to avoid leaving this page)
                window.open(testUrl, '_blank');
            } catch (error) {
                log('navTest', `‚ùå Calendar navigation error: ${error.message}`, 'error');
            }
        }
        
        function testTaxCalcNav() {
            const container = document.getElementById('navTest');
            log('navTest', 'Testing navigation to tax calculator...', 'info');
            
            try {
                const testUrl = 'pages/tax-calculator.html';
                const url = new URL(testUrl, window.location.href);
                log('navTest', `‚úÖ Tax calc URL is valid: ${url.href}`, 'success');
                window.open(testUrl, '_blank');
            } catch (error) {
                log('navTest', `‚ùå Tax calc navigation error: ${error.message}`, 'error');
            }
        }
        
        function testReturnNav() {
            log('navTest', 'Testing return navigation to main app...', 'info');
            
            try {
                // Simulate navigateToMainApp function
                const testUrl = 'index.html#calculator';
                const url = new URL(testUrl, window.location.href);
                log('navTest', `‚úÖ Return URL is valid: ${url.href}`, 'success');
                window.open(testUrl, '_blank');
            } catch (error) {
                log('navTest', `‚ùå Return navigation error: ${error.message}`, 'error');
            }
        }
        
        function testCrossPageFlow() {
            const container = document.getElementById('crossPageTest');
            container.innerHTML = '';
            
            log('crossPageTest', 'üîÑ Testing complete navigation flow...', 'info');
            log('crossPageTest', '1. Starting from main app (index.html)', 'info');
            log('crossPageTest', '2. Navigation link: pages/calendar.html', 'info');
            log('crossPageTest', '3. Expected: Tax Calculator visible in calendar navigation', 'info');
            log('crossPageTest', '4. Click Tax Calculator from calendar page', 'info');
            log('crossPageTest', '5. Expected: Successfully navigate to tax-calculator.html', 'info');
            
            // Open calendar page and check if Tax Calculator link exists
            setTimeout(() => {
                log('crossPageTest', '‚è±Ô∏è Opening calendar page to verify Tax Calculator link...', 'info');
                const calendarWindow = window.open('pages/calendar.html', 'calendarTest');
                
                setTimeout(() => {
                    try {
                        if (calendarWindow && !calendarWindow.closed) {
                            log('crossPageTest', '‚úÖ Calendar page opened successfully', 'success');
                            log('crossPageTest', 'üìã Manual check required: Verify Tax Calculator is visible in navigation', 'info');
                        }
                    } catch (error) {
                        log('crossPageTest', `‚ùå Cross-page test error: ${error.message}`, 'error');
                    }
                }, 2000);
            }, 1000);
        }
        
        function checkConsoleErrors() {
            const container = document.getElementById('consoleErrors');
            container.innerHTML = '';
            
            if (capturedErrors.length === 0) {
                log('consoleErrors', '‚úÖ No console errors captured so far', 'success');
            } else {
                log('consoleErrors', `‚ùå Found ${capturedErrors.length} console errors:`, 'error');
                capturedErrors.forEach((error, index) => {
                    log('consoleErrors', `${index + 1}. ${error}`, 'error');
                });
            }
            
            // Check for common issues
            log('consoleErrors', 'üîç Checking for common navigation issues...', 'info');
            
            // Test if navigation functions exist
            if (typeof window.location !== 'undefined') {
                log('consoleErrors', '‚úÖ window.location is available', 'success');
            } else {
                log('consoleErrors', '‚ùå window.location is not available', 'error');
            }
        }
        
        // Auto-run file check on load
        window.addEventListener('load', function() {
            log('fileCheck', 'Diagnostic tool loaded. Click buttons to run tests.', 'info');
        });
    </script>
</body>
</html>